<!-- src/app/components/admin/admin-bar/admin-bar.component.html -->
<div class="admin-bar">

  <!-- Loading overlay -->
  <div class="loading-overlay" *ngIf="cargando">
    <div class="d-flex align-items-center justify-content-center h-100">
      <div class="text-center">
        <div class="spinner-border text-primary mb-3" style="width: 3rem; height: 3rem;"></div>
        <p class="text-muted">Cargando productos del bar...</p>
      </div>
    </div>
  </div>

  <!-- ========== VISTA LISTA ========== -->
  <ng-container *ngIf="vistaActual === 'lista' && !cargando">
    
    <!-- Header con estad√≠sticas -->
    <div class="row mb-4">
      <div class="col-12">
        <div class="welcome-card bg-gradient-warning text-dark p-4 rounded-3 shadow">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h4 class="mb-1">
                <i class="fas fa-utensils me-2"></i>
                Gesti√≥n del Bar
              </h4>
              <p class="mb-0 opacity-75">
                <i class="fas fa-cubes me-2"></i>
                {{ estadisticas.total }} productos en total ‚Ä¢ {{ estadisticas.disponibles }} disponibles
                <!-- üÜï MOSTRAR PRODUCTOS ELIMINADOS -->
                <span *ngIf="estadisticas.eliminados > 0">
                  ‚Ä¢ {{ estadisticas.eliminados }} en papelera
                </span>
              </p>
            </div>
            <div class="d-none d-md-block">
              <i class="fas fa-cocktail fa-3x opacity-50"></i>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Estad√≠sticas r√°pidas -->
    <div class="row mb-4 g-3">
      <div class="col-lg-2 col-md-4 col-sm-6">
        <div class="card stat-card bg-warning text-dark h-100 border-0 shadow">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-center">
              <div>
                <div class="stat-number">{{ estadisticas.total }}</div>
                <div class="stat-label">Total Productos</div>
              </div>
              <div class="stat-icon">
                <i class="fas fa-cubes fa-2x"></i>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <div class="col-lg-2 col-md-4 col-sm-6">
        <div class="card stat-card bg-success text-white h-100 border-0 shadow">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-center">
              <div>
                <div class="stat-number">{{ estadisticas.disponibles }}</div>
                <div class="stat-label">Disponibles</div>
              </div>
              <div class="stat-icon">
                <i class="fas fa-check-circle fa-2x"></i>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <div class="col-lg-2 col-md-4 col-sm-6">
        <div class="card stat-card bg-danger text-white h-100 border-0 shadow">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-center">
              <div>
                <div class="stat-number">{{ estadisticas.combos }}</div>
                <div class="stat-label">Combos</div>
              </div>
              <div class="stat-icon">
                <i class="fas fa-gift fa-2x"></i>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <div class="col-lg-2 col-md-4 col-sm-6">
        <div class="card stat-card bg-secondary text-white h-100 border-0 shadow">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-center">
              <div>
                <div class="stat-number">{{ estadisticas.noDisponibles }}</div>
                <div class="stat-label">No Disponibles</div>
              </div>
              <div class="stat-icon">
                <i class="fas fa-times-circle fa-2x"></i>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- üÜï NUEVA TARJETA: Productos eliminados -->
      <div class="col-lg-2 col-md-4 col-sm-6">
        <div class="card stat-card h-100 border-0 shadow cursor-pointer" 
             [class.bg-dark]="estadisticas.eliminados > 0"
             [class.bg-light]="estadisticas.eliminados === 0"
             [class.text-white]="estadisticas.eliminados > 0"
             [class.text-dark]="estadisticas.eliminados === 0"
             (click)="cambiarVista('papelera')"
             title="Ver papelera de productos eliminados">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-center">
              <div>
                <div class="stat-number">{{ estadisticas.eliminados }}</div>
                <div class="stat-label">Papelera</div>
              </div>
              <div class="stat-icon">
                <i class="fas fa-trash fa-2x"></i>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- üÜï NUEVA TARJETA: Acceso r√°pido a agregar -->
      <div class="col-lg-2 col-md-4 col-sm-6">
        <div class="card stat-card bg-primary text-white h-100 border-0 shadow cursor-pointer"
             (click)="mostrarFormularioAgregar()"
             title="Agregar nuevo producto">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-center">
              <div>
                <div class="stat-number">
                  <i class="fas fa-plus fa-2x"></i>
                </div>
                <div class="stat-label">Nuevo Producto</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Herramientas y filtros -->
    <div class="row mb-4">
      <div class="col-12">
        <div class="card shadow-sm">
          <div class="card-header bg-light">
            <div class="d-flex justify-content-between align-items-center">
              <h6 class="mb-0">
                <i class="fas fa-filter me-2 text-primary"></i>
                Filtros y Herramientas
              </h6>
              <div class="btn-group" role="group">
                <button class="btn btn-success btn-sm" (click)="mostrarFormularioAgregar()">
                  <i class="fas fa-plus me-1"></i>Nuevo Producto
                </button>
                <!-- üÜï BOT√ìN PARA PAPELERA -->
                <button class="btn btn-dark btn-sm" 
                        (click)="cambiarVista('papelera')"
                        [disabled]="estadisticas.eliminados === 0">
                  <i class="fas fa-trash me-1"></i>
                  Papelera ({{ estadisticas.eliminados }})
                </button>
                <button class="btn btn-outline-secondary btn-sm" (click)="exportarProductos()">
                  <i class="fas fa-download me-1"></i>Exportar
                </button>
              </div>
            </div>
          </div>
          <div class="card-body">
            <div class="row g-3">
              
              <!-- B√∫squeda por texto -->
              <div class="col-lg-4 col-md-6">
                <label class="form-label small fw-semibold">Buscar productos</label>
                <div class="input-group">
                  <input type="text" 
                         class="form-control" 
                         placeholder="Nombre, descripci√≥n..."
                         [(ngModel)]="terminoBusqueda"
                         (input)="aplicarFiltros()">
                  <button class="btn btn-outline-secondary" type="button">
                    <i class="fas fa-search"></i>
                  </button>
                </div>
              </div>
              
              <!-- Filtro por categor√≠a -->
              <div class="col-lg-2 col-md-6">
                <label class="form-label small fw-semibold">Categor√≠a</label>
                <select class="form-select" 
                        [(ngModel)]="filtroCategoria"
                        (change)="aplicarFiltros()">
                  <option value="">Todas las categor√≠as</option>
                  <option *ngFor="let categoria of categoriasDisponibles" [value]="categoria">
                    {{ categoria }}
                  </option>
                </select>
              </div>
              
              <!-- Filtro por disponibilidad -->
              <div class="col-lg-2 col-md-6">
                <label class="form-label small fw-semibold">Estado</label>
                <select class="form-select" 
                        [(ngModel)]="filtroDisponibilidad"
                        (change)="aplicarFiltros()">
                  <option value="">Todos los estados</option>
                  <option value="true">Disponibles</option>
                  <option value="false">No disponibles</option>
                </select>
              </div>
              
              <!-- Items por p√°gina -->
              <div class="col-lg-2 col-md-6">
                <label class="form-label small fw-semibold">Mostrar</label>
                <select class="form-select" 
                        [(ngModel)]="productosPorPagina"
                        (change)="calcularPaginacion()">
                  <option value="5">5 por p√°gina</option>
                  <option value="10">10 por p√°gina</option>
                  <option value="20">20 por p√°gina</option>
                  <option value="50">50 por p√°gina</option>
                </select>
              </div>
              
              <!-- Bot√≥n limpiar filtros -->
              <div class="col-lg-2 col-md-6">
                <label class="form-label small fw-semibold">&nbsp;</label>
                <div class="d-grid">
                  <button class="btn btn-outline-danger btn-sm" (click)="limpiarFiltros()">
                    <i class="fas fa-times me-1"></i>Limpiar
                  </button>
                </div>
              </div>
              
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Lista de productos -->
    <div class="row mb-4">
      <div class="col-12">
        <div class="card shadow-sm">
          <div class="card-header bg-light d-flex justify-content-between align-items-center">
            <h6 class="mb-0">
              <i class="fas fa-list me-2 text-success"></i>
              Productos del Bar ({{ getRangoElementos() }})
            </h6>
          </div>
          <div class="card-body p-0">
            
            <!-- Loading durante filtrado -->
            <div class="text-center p-4" *ngIf="procesando">
              <div class="spinner-border text-primary"></div>
              <p class="mt-2 text-muted">Procesando...</p>
            </div>

            <!-- Tabla de productos -->
            <div class="table-responsive" *ngIf="!procesando">
              <table class="table table-hover mb-0">
                <thead class="bg-light">
                  <tr>
                    <th width="60">ID</th>
                    <th width="300">Producto</th>
                    <th width="120">Categor√≠a</th>
                    <th width="100">Precio</th>
                    <th width="80">Estado</th>
                    <th width="80">Tipo</th>
                    <th width="150">Acciones</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let producto of getProductosPaginaActual(); trackBy: trackProductoFn" 
                      class="align-middle">
                    
                    <!-- ID -->
                    <td>
                      <span class="badge bg-secondary">{{ producto.id }}</span>
                    </td>
                    
                    <!-- Producto con imagen -->
                    <td>
                      <div class="d-flex align-items-center">
                        <img [src]="producto.imagen" 
                             class="rounded me-3" 
                             width="50" height="50"
                             [alt]="producto.nombre"
                             style="object-fit: cover;">
                        <div>
                          <h6 class="mb-1 fw-bold">{{ producto.nombre }}</h6>
                          <small class="text-muted">
                            {{ producto.descripcion | slice:0:50 }}{{ producto.descripcion.length > 50 ? '...' : '' }}
                          </small>
                        </div>
                      </div>
                    </td>
                    
                    <!-- Categor√≠a -->
                    <td>
                      <span class="badge fs-6 px-2 py-1" [ngClass]="getCategoriaClass(producto.categoria)">
                        {{ producto.categoria }}
                      </span>
                    </td>
                    
                    <!-- Precio -->
                    <td>
                      <div>
                        <span class="fw-bold text-success">${{ formatearPrecio(producto.precio) }}</span>
                        <div *ngIf="producto.es_combo && producto.descuento" class="small">
                          <span class="text-decoration-line-through text-muted">
                            ${{ formatearPrecio(producto.precio + producto.descuento) }}
                          </span>
                          <small class="text-danger ms-1">-${{ formatearPrecio(producto.descuento) }}</small>
                        </div>
                      </div>
                    </td>
                    
                    <!-- Estado -->
                    <td>
                      <div class="form-check form-switch">
                        <input class="form-check-input" 
                               type="checkbox" 
                               [checked]="producto.disponible"
                               (change)="toggleDisponibilidad(producto)">
                        <label class="form-check-label">
                          <span class="badge" [ngClass]="producto.disponible ? 'bg-success' : 'bg-danger'">
                            {{ producto.disponible ? 'Activo' : 'Inactivo' }}
                          </span>
                        </label>
                      </div>
                    </td>
                    
                    <!-- Tipo -->
                    <td>
                      <div class="d-flex flex-column gap-1">
                        <span class="badge bg-info" *ngIf="producto.es_combo">
                          <i class="fas fa-gift me-1"></i>Combo
                        </span>
                        <span class="badge bg-secondary" *ngIf="producto.tamanos?.length">
                          <i class="fas fa-arrows-alt me-1"></i>Tama√±os
                        </span>
                        <span class="badge bg-warning" *ngIf="producto.extras?.length">
                          <i class="fas fa-plus me-1"></i>Extras
                        </span>
                      </div>
                    </td>
                    
                    <!-- Acciones -->
                    <td>
                      <div class="btn-group btn-group-sm" role="group">
                        <button class="btn btn-outline-primary" 
                                (click)="mostrarFormularioEditar(producto)"
                                title="Editar producto">
                          <i class="fas fa-edit"></i>
                        </button>
                        <!-- üÜï MODIFICADO: Soft delete -->
                        <button class="btn btn-outline-warning" 
                                (click)="confirmarEliminarProducto(producto, 'soft')"
                                title="Mover a papelera">
                          <i class="fas fa-trash"></i>
                        </button>
                      </div>
                    </td>
                    
                  </tr>
                </tbody>
              </table>
            </div>

            <!-- Sin resultados -->
            <div class="text-center p-4" *ngIf="!procesando && !getProductosPaginaActual().length">
              <i class="fas fa-utensils fa-3x text-muted mb-3"></i>
              <h5 class="text-muted">No se encontraron productos</h5>
              <p class="text-muted">
                {{ (terminoBusqueda || filtroCategoria || filtroDisponibilidad) 
                   ? 'Intenta cambiar los filtros de b√∫squeda.' 
                   : 'No hay productos registrados en el bar.' }}
              </p>
              <button class="btn" 
                      [ngClass]="(terminoBusqueda || filtroCategoria || filtroDisponibilidad) ? 'btn-outline-primary' : 'btn-success'"
                      (click)="(terminoBusqueda || filtroCategoria || filtroDisponibilidad) ? limpiarFiltros() : mostrarFormularioAgregar()">
                <i [class]="(terminoBusqueda || filtroCategoria || filtroDisponibilidad) ? 'fas fa-times me-2' : 'fas fa-plus me-2'"></i>
                {{ (terminoBusqueda || filtroCategoria || filtroDisponibilidad) ? 'Limpiar Filtros' : 'Agregar Primer Producto' }}
              </button>
            </div>

          </div>
          
          <!-- Paginaci√≥n -->
          <div class="card-footer bg-light" *ngIf="!procesando && totalPaginas > 1">
            <nav aria-label="Paginaci√≥n de productos">
              <ul class="pagination pagination-sm justify-content-center mb-0">
                
                <!-- Anterior -->
                <li class="page-item" [class.disabled]="paginaActual === 1">
                  <button class="page-link" (click)="cambiarPagina(paginaActual - 1)">
                    <i class="fas fa-chevron-left"></i>
                  </button>
                </li>
                
                <!-- Primera p√°gina -->
                <li class="page-item" *ngIf="paginaActual > 3">
                  <button class="page-link" (click)="cambiarPagina(1)">1</button>
                </li>
                <li class="page-item disabled" *ngIf="paginaActual > 4">
                  <span class="page-link">...</span>
                </li>
                
                <!-- N√∫meros de p√°gina -->
                <li class="page-item" 
                    *ngFor="let pagina of getPaginasArray()"
                    [class.active]="pagina === paginaActual">
                  <button class="page-link" (click)="cambiarPagina(pagina)">{{ pagina }}</button>
                </li>
                
                <!-- √öltima p√°gina -->
                <li class="page-item disabled" *ngIf="paginaActual < totalPaginas - 3">
                  <span class="page-link">...</span>
                </li>
                <li class="page-item" *ngIf="paginaActual < totalPaginas - 2">
                  <button class="page-link" (click)="cambiarPagina(totalPaginas)">{{ totalPaginas }}</button>
                </li>
                
                <!-- Siguiente -->
                <li class="page-item" [class.disabled]="paginaActual === totalPaginas">
                  <button class="page-link" (click)="cambiarPagina(paginaActual + 1)">
                    <i class="fas fa-chevron-right"></i>
                  </button>
                </li>
                
              </ul>
            </nav>
          </div>
          
        </div>
      </div>
    </div>

  </ng-container>

  <!-- ========== üÜï NUEVA VISTA: PAPELERA ========== -->
  <ng-container *ngIf="vistaActual === 'papelera' && !cargando">
    
    <!-- Header de la papelera -->
    <div class="row mb-4">
      <div class="col-12">
        <div class="card border-dark">
          <div class="card-header bg-dark text-white">
            <div class="d-flex justify-content-between align-items-center">
              <h5 class="mb-0">
                <i class="fas fa-trash me-2"></i>
                Papelera de Productos Eliminados
              </h5>
              <button class="btn btn-outline-light btn-sm" (click)="cambiarVista('lista')">
                <i class="fas fa-arrow-left me-1"></i>Volver a la Lista
              </button>
            </div>
          </div>
          <div class="card-body">
            <div class="alert alert-info" role="alert">
              <i class="fas fa-info-circle me-2"></i>
              <strong>Papelera:</strong> Aqu√≠ puedes ver los productos eliminados. Puedes restaurarlos o eliminarlos permanentemente.
              <span *ngIf="productosEliminados.length === 0" class="d-block mt-2">
                <i class="fas fa-check-circle me-1"></i> No hay productos en la papelera.
              </span>
            </div>
            
            <!-- Lista de productos eliminados -->
            <div *ngIf="productosEliminados.length > 0">
              <div class="table-responsive">
                <table class="table table-hover">
                  <thead class="bg-light">
                    <tr>
                      <th>ID</th>
                      <th>Producto</th>
                      <th>Categor√≠a</th>
                      <th>Precio</th>
                      <th>Fecha Eliminaci√≥n</th>
                      <th>Acciones</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let producto of productosEliminados" class="align-middle">
                      
                      <!-- ID -->
                      <td>
                        <span class="badge bg-dark">{{ producto.id }}</span>
                      </td>
                      
                      <!-- Producto -->
                      <td>
                        <div class="d-flex align-items-center opacity-75">
                          <img [src]="producto.imagen" 
                               class="rounded me-3" 
                               width="40" height="40"
                               [alt]="producto.nombre"
                               style="object-fit: cover; filter: grayscale(100%);">
                          <div>
                            <h6 class="mb-1 fw-bold text-muted">{{ producto.nombre }}</h6>
                            <small class="text-muted">
                              {{ producto.descripcion | slice:0:40 }}{{ producto.descripcion.length > 40 ? '...' : '' }}
                            </small>
                          </div>
                        </div>
                      </td>
                      
                      <!-- Categor√≠a -->
                      <td>
                        <span class="badge bg-secondary">{{ producto.categoria }}</span>
                      </td>
                      
                      <!-- Precio -->
                      <td>
                        <span class="text-muted">${{ formatearPrecio(producto.precio) }}</span>
                      </td>
                      
                      <!-- Fecha eliminaci√≥n -->
                      <td>
                        <small class="text-muted">
                          {{ producto.fecha_actualizacion | date:'dd/MM/yyyy HH:mm' }}
                        </small>
                      </td>
                      
                      <!-- Acciones -->
                      <td>
                        <div class="btn-group btn-group-sm" role="group">
                          <!-- üÜï BOT√ìN RESTAURAR -->
                          <button class="btn btn-outline-success" 
                                  (click)="confirmarRestaurarProducto(producto)"
                                  title="Restaurar producto">
                            <i class="fas fa-undo"></i>
                          </button>
                          <!-- üÜï BOT√ìN ELIMINAR PERMANENTEMENTE -->
                          <button class="btn btn-outline-danger" 
                                  (click)="confirmarEliminarProducto(producto, 'hard')"
                                  title="Eliminar permanentemente">
                            <i class="fas fa-times"></i>
                          </button>
                        </div>
                      </td>
                      
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

  </ng-container>

  <!-- ========== VISTA FORMULARIO (AGREGAR/EDITAR) ========== -->
  <ng-container *ngIf="vistaActual === 'agregar' || vistaActual === 'editar'">
    
    <!-- Header del formulario -->
    <div class="row mb-4">
      <div class="col-12">
        <div class="card border-success">
          <div class="card-header bg-success text-white">
            <div class="d-flex justify-content-between align-items-center">
              <h5 class="mb-0">
                <i class="fas fa-utensils me-2"></i>
                {{ vistaActual === 'agregar' ? 'Nuevo Producto del Bar' : 'Editar Producto del Bar' }}
              </h5>
              <button class="btn btn-outline-light btn-sm" (click)="cambiarVista('lista')">
                <i class="fas fa-arrow-left me-1"></i>Volver a la Lista
              </button>
            </div>
          </div>
          <div class="card-body">
            
            <!-- Errores de validaci√≥n -->
            <div class="alert alert-danger" *ngIf="erroresValidacion.length">
              <h6 class="alert-heading">
                <i class="fas fa-exclamation-triangle me-2"></i>
                Errores en el formulario:
              </h6>
              <ul class="mb-0">
                <li *ngFor="let error of erroresValidacion">{{ error }}</li>
              </ul>
            </div>
            
            <!-- Formulario -->
            <form (ngSubmit)="guardarProducto()" #productoFormRef="ngForm">
              
              <!-- Informaci√≥n b√°sica -->
              <div class="row g-3 mb-4">
                <div class="col-12">
                  <h6 class="text-success border-bottom pb-2">
                    <i class="fas fa-info-circle me-2"></i>Informaci√≥n B√°sica
                  </h6>
                </div>
                
                <!-- Nombre -->
                <div class="col-md-6">
                  <label class="form-label fw-semibold">
                    <i class="fas fa-tag me-1 text-success"></i>
                    Nombre del Producto *
                  </label>
                  <input type="text" 
                         class="form-control" 
                         [(ngModel)]="productoForm.nombre"
                         name="nombre"
                         placeholder="Ej: Coca-Cola Grande"
                         required>
                </div>
                
                <!-- Categor√≠a -->
                <div class="col-md-6">
                  <label class="form-label fw-semibold">
                    <i class="fas fa-list me-1 text-success"></i>
                    Categor√≠a *
                  </label>
                  <select class="form-select" 
                          [(ngModel)]="productoForm.categoria"
                          name="categoria"
                          required>
                    <option value="">Seleccionar categor√≠a</option>
                    <option *ngFor="let categoria of categoriasDisponibles" [value]="categoria">
                      {{ categoria }}
                    </option>
                  </select>
                </div>
                
                <!-- Descripci√≥n -->
                <div class="col-12">
                  <label class="form-label fw-semibold">
                    <i class="fas fa-align-left me-1 text-success"></i>
                    Descripci√≥n *
                  </label>
                  <textarea class="form-control" 
                            rows="3"
                            [(ngModel)]="productoForm.descripcion"
                            name="descripcion"
                            placeholder="Describe el producto del bar..."
                            required></textarea>
                </div>
                
                <!-- Precio -->
                <div class="col-md-6">
                  <label class="form-label fw-semibold">
                    <i class="fas fa-dollar-sign me-1 text-success"></i>
                    Precio Base *
                  </label>
                  <div class="input-group">
                    <span class="input-group-text">$</span>
                    <input type="number" 
                           class="form-control" 
                           [(ngModel)]="productoForm.precio"
                           name="precio"
                           min="0.01"
                           step="0.01"
                           placeholder="0.00"
                           required>
                  </div>
                </div>
                
                <!-- URL de la imagen con vista previa -->
                <div class="col-12">
                  <label class="form-label fw-semibold">
                    <i class="fas fa-image me-1 text-success"></i>
                    URL de la Imagen *
                  </label>
                  
                  <div class="row">
                    <!-- Input del URL -->
                    <div class="col-md-8">
                      <input type="text" 
                             class="form-control" 
                             [(ngModel)]="productoForm.imagen"
                             name="imagen"
                             placeholder="https://ejemplo.com/imagen.jpg o assets/bar/producto.png"
                             required>
                      <small class="form-text text-muted">
                        Puedes usar URLs de internet o rutas locales como assets/bar/producto.png
                      </small>
                    </div>
                    
                    <!-- Vista previa -->
                    <div class="col-md-4">
                      <div class="image-preview-container text-center">
                        <div *ngIf="productoForm.imagen?.trim(); else noImage" 
                             class="border rounded p-2 bg-light">
                          <img [src]="productoForm.imagen" 
                               class="img-fluid rounded" 
                               style="max-height: 120px; max-width: 100%; object-fit: cover;"
                               [alt]="productoForm.nombre || 'Vista previa'"
                               (error)="onImageError($event)"
                               (load)="onImageLoad($event)">
                          <div class="mt-1">
                            <small class="text-success" *ngIf="imageLoaded">
                              <i class="fas fa-check-circle"></i> Imagen v√°lida
                            </small>
                            <small class="text-danger" *ngIf="imageError">
                              <i class="fas fa-exclamation-triangle"></i> Error al cargar
                            </small>
                          </div>
                        </div>
                        <ng-template #noImage>
                          <div class="border rounded p-3 bg-light text-muted">
                            <i class="fas fa-utensils fa-2x"></i>
                            <br>
                            <small>Vista previa del producto</small>
                          </div>
                        </ng-template>
                      </div>
                    </div>
                  </div>
                  
                  <!-- Ejemplos de URLs -->
                  <div class="mt-2">
                    <small class="text-muted"><strong>Ejemplos para productos del bar:</strong></small>
                    <div class="d-flex flex-wrap gap-2 mt-1">
                      <button type="button" 
                              class="btn btn-outline-secondary btn-sm"
                              (click)="setExampleImage('assets/bar/coca-cola.png')">
                        <i class="fas fa-folder me-1"></i>Bebida Local
                      </button>
                      <button type="button" 
                              class="btn btn-outline-secondary btn-sm"
                              (click)="setExampleImage('assets/bar/palomitas.png')">
                        <i class="fas fa-folder me-1"></i>Snack Local
                      </button>
                      <button type="button" 
                              class="btn btn-outline-secondary btn-sm"
                              (click)="setExampleImage('https://via.placeholder.com/300x300/ffc107/000000?text=Producto+Bar')">
                        <i class="fas fa-globe me-1"></i>URL Externa
                      </button>
                      <button type="button" 
                              class="btn btn-outline-secondary btn-sm"
                              (click)="setExampleImage('https://images.unsplash.com/photo-1585936650265-c85cf2d04c95?w=300&h=300&fit=crop')">
                        <i class="fas fa-cocktail me-1"></i>Ejemplo Bebida
                      </button>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Estados del producto -->
              <div class="row g-3 mb-4">
                <div class="col-12">
                  <h6 class="text-success border-bottom pb-2">
                    <i class="fas fa-toggle-on me-2"></i>Estado del Producto
                  </h6>
                </div>
                
                <div class="col-md-6">
                  <div class="form-check form-switch">
                    <input class="form-check-input" 
                           type="checkbox" 
                           [(ngModel)]="productoForm.disponible"
                           name="disponible"
                           id="disponibleCheck">
                    <label class="form-check-label fw-semibold" for="disponibleCheck">
                      <i class="fas fa-check-circle me-1 text-success"></i>
                      Producto disponible para venta
                    </label>
                  </div>
                </div>
                
                <div class="col-md-6">
                  <div class="form-check form-switch">
                    <input class="form-check-input" 
                           type="checkbox" 
                           [(ngModel)]="productoForm.es_combo"
                           name="esCombo"
                           id="esComboCheck">
                    <label class="form-check-label fw-semibold" for="esComboCheck">
                      <i class="fas fa-gift me-1 text-danger"></i>
                      Es un combo especial
                    </label>
                  </div>
                </div>
              </div>

              <!-- Configuraci√≥n de combo -->
              <ng-container *ngIf="productoForm.es_combo">
                <div class="row g-3 mb-4">
                  <div class="col-12">
                    <h6 class="text-danger border-bottom pb-2">
                      <i class="fas fa-gift me-2"></i>Configuraci√≥n del Combo
                    </h6>
                  </div>
                  
                  <!-- Descuento del combo -->
                  <div class="col-md-6">
                    <label class="form-label fw-semibold">
                      <i class="fas fa-percentage me-1 text-danger"></i>
                      Descuento del Combo
                    </label>
                    <div class="input-group">
                      <span class="input-group-text">$</span>
                      <input type="number" 
                             class="form-control" 
                             [(ngModel)]="productoForm.descuento"
                             name="descuento"
                             min="0"
                             step="0.01"
                             placeholder="0.00">
                    </div>
                    <small class="form-text text-muted">
                      Cantidad de dinero que se descuenta del precio total
                    </small>
                  </div>
                  
                  <!-- Items incluidos en el combo -->
                  <div class="col-12">
                    <label class="form-label fw-semibold">
                      <i class="fas fa-list me-1 text-danger"></i>
                      Items Incluidos en el Combo
                    </label>
                    
                    <div class="combo-items">
                      <div class="row g-2 mb-2" *ngFor="let item of productoForm.combo_items; let i = index">
                        <div class="col-10">
                          <input type="text" 
                                 class="form-control" 
                                 [(ngModel)]="productoForm.combo_items![i].item_nombre"
                                 [name]="'combo_item_' + i"
                                 placeholder="Ej: Palomitas medianas">
                        </div>
                        <div class="col-2">
                          <button type="button" 
                                  class="btn btn-outline-danger w-100"
                                  (click)="removerItemCombo(i)">
                            <i class="fas fa-trash"></i>
                          </button>
                        </div>
                      </div>
                      
                      <button type="button" 
                              class="btn btn-outline-success btn-sm"
                              (click)="agregarItemCombo()">
                        <i class="fas fa-plus me-1"></i>Agregar Item al Combo
                      </button>
                    </div>
                  </div>
                </div>
              </ng-container>

              <!-- Tama√±os disponibles -->
              <div class="row g-3 mb-4">
                <div class="col-12">
                  <h6 class="text-primary border-bottom pb-2">
                    <i class="fas fa-arrows-alt me-2"></i>Tama√±os Disponibles (Opcional)
                  </h6>
                </div>
                
                <div class="col-12">
                  <div class="tamanos-container">
                    <div class="row g-2 mb-2" *ngFor="let tamano of productoForm.tamanos; let i = index">
                      <div class="col-md-6">
                        <input type="text" 
                               class="form-control" 
                               [(ngModel)]="productoForm.tamanos![i].nombre"
                               [name]="'tamano_nombre_' + i"
                               placeholder="Ej: Grande (32oz)">
                      </div>
                      <div class="col-md-4">
                        <div class="input-group">
                          <span class="input-group-text">$</span>
                          <input type="number" 
                                 class="form-control" 
                                 [(ngModel)]="productoForm.tamanos![i].precio"
                                 [name]="'tamano_precio_' + i"
                                 min="0"
                                 step="0.01"
                                 placeholder="0.00">
                        </div>
                      </div>
                      <div class="col-md-2">
                        <button type="button" 
                                class="btn btn-outline-danger w-100"
                                (click)="removerTamano(i)">
                          <i class="fas fa-trash"></i>
                        </button>
                      </div>
                    </div>
                    
                    <button type="button" 
                            class="btn btn-outline-primary btn-sm"
                            (click)="agregarTamano()">
                      <i class="fas fa-plus me-1"></i>Agregar Tama√±o
                    </button>
                  </div>
                </div>
              </div>

              <!-- Extras disponibles -->
              <div class="row g-3 mb-4">
                <div class="col-12">
                  <h6 class="text-warning border-bottom pb-2">
                    <i class="fas fa-plus me-2"></i>Extras Disponibles (Opcional)
                  </h6>
                </div>
                
                <div class="col-12">
                  <div class="extras-container">
                    <div class="row g-2 mb-2" *ngFor="let extra of productoForm.extras; let i = index">
                      <div class="col-md-6">
                        <input type="text" 
                               class="form-control" 
                               [(ngModel)]="productoForm.extras![i].nombre"
                               [name]="'extra_nombre_' + i"
                               placeholder="Ej: Queso extra">
                      </div>
                      <div class="col-md-4">
                        <div class="input-group">
                          <span class="input-group-text">$</span>
                          <input type="number" 
                                 class="form-control" 
                                 [(ngModel)]="productoForm.extras![i].precio"
                                 [name]="'extra_precio_' + i"
                                 min="0"
                                 step="0.01"
                                 placeholder="0.00">
                        </div>
                      </div>
                      <div class="col-md-2">
                        <button type="button" 
                                class="btn btn-outline-danger w-100"
                                (click)="removerExtra(i)">
                          <i class="fas fa-trash"></i>
                        </button>
                      </div>
                    </div>
                    
                    <button type="button" 
                            class="btn btn-outline-warning btn-sm"
                            (click)="agregarExtra()">
                      <i class="fas fa-plus me-1"></i>Agregar Extra
                    </button>
                  </div>
                </div>
              </div>
              
              <!-- Botones de acci√≥n -->
              <div class="row mt-4">
                <div class="col-12">
                  <div class="d-flex justify-content-end gap-2">
                    <button type="button" 
                            class="btn btn-outline-secondary"
                            (click)="cambiarVista('lista')">
                      <i class="fas fa-times me-1"></i>Cancelar
                    </button>
                    
                    <button type="submit" 
                            class="btn btn-success"
                            [disabled]="procesando || !productoFormRef.form.valid">
                      <span *ngIf="procesando" class="spinner-border spinner-border-sm me-2"></span>
                      <i class="fas fa-save me-1" *ngIf="!procesando"></i>
                      {{ vistaActual === 'agregar' ? 'Crear Producto' : 'Actualizar Producto' }}
                    </button>
                  </div>
                </div>
              </div>
              
            </form>
          </div>
        </div>
      </div>
    </div>
    
  </ng-container>

</div>

<!-- üÜï MODAL DE CONFIRMACI√ìN MEJORADO -->
<div class="modal fade" [class.show]="mostrarModalConfirmacion" 
     [style.display]="mostrarModalConfirmacion ? 'block' : 'none'"
     *ngIf="mostrarModalConfirmacion">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header" 
           [ngClass]="{
             'bg-warning text-dark': tipoEliminacion === 'soft',
             'bg-danger text-white': tipoEliminacion === 'hard',
             'bg-success text-white': tipoEliminacion === 'restore'
           }">
        <h5 class="modal-title">
          <i class="fas me-2"
             [ngClass]="{
               'fa-exclamation-triangle': tipoEliminacion === 'soft',
               'fa-times-circle': tipoEliminacion === 'hard',
               'fa-undo': tipoEliminacion === 'restore'
             }"></i>
          {{ getTituloModal() }}
        </h5>
      </div>
      <div class="modal-body">
        <p class="mb-3">
          <strong>{{ getMensajeModal() }}</strong>
        </p>
        <div *ngIf="tipoEliminacion === 'hard'" class="alert alert-danger">
          <i class="fas fa-exclamation-triangle me-2"></i>
          <strong>¬°ATENCI√ìN!</strong> Esta acci√≥n es irreversible.
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" 
                class="btn btn-outline-secondary"
                (click)="cerrarModalConfirmacion()">
          <i class="fas fa-times me-1"></i>
          Cancelar
        </button>
        <button type="button" 
                [class]="'btn ' + getClaseBotonModal()"
                (click)="eliminarProducto()"
                [disabled]="procesando">
          <span *ngIf="procesando" class="spinner-border spinner-border-sm me-2"></span>
          <i class="fas me-1" 
             [ngClass]="{
               'fa-trash': tipoEliminacion === 'soft',
               'fa-times': tipoEliminacion === 'hard',
               'fa-undo': tipoEliminacion === 'restore'
             }" 
             *ngIf="!procesando"></i>
          {{ getTextoBotonModal() }}
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Backdrop del modal -->
<div class="modal-backdrop fade show" *ngIf="mostrarModalConfirmacion"></div>

<style>
.cursor-pointer {
  cursor: pointer;
}

.cursor-pointer:hover {
  transform: translateY(-2px);
  transition: transform 0.2s ease;
}

.stat-card:hover {
  transform: translateY(-2px);
  transition: all 0.2s ease;
}

.papelera-item {
  opacity: 0.7;
  transition: opacity 0.2s ease;
}

.papelera-item:hover {
  opacity: 1;
}
</style>